<!DOCTYPE html><html><head><link rel="stylesheet" type="text/css" href="/assets/lib/bootstrap/main/dist/css/bootstrap.min.css"><link rel="stylesheet" type="text/css" href="/assets/lib/@loadingio/bootstrap.ext/main/index.min.css"><link rel="stylesheet" type="text/css" href="/assets/lib/ldcover/main/index.min.css"><style type="text/css">html,body{width:100%;height:100%;margin:0;padding:0}.charts{position:absolute;z-index:var(--z-float);bottom:1em;left:1em;display:flex;gap:1em}.charts .label{text-shadow:0 0 4px #fff;background:rgba(255,255,255,0.8);padding:0 .2em;margin-bottom:.1em;border-radius:.25em}.chart{width:10em;height:6em;border-radius:.25em;box-shadow:0 2px 4px rgba(0,0,0,0.3);background:#fff;padding:.5em}.ldcv-popup .label{width:4em;text-align:right;opacity:.8}.ldcv-popup .value{font-weight:700}</style></head><body><div class="w-100 h-100" id="map"></div><div class="d-flex charts"><div class="p-2"><div class="label text-sm">屋齡分布</div><div class="chart" ld="chart" data-name="age"></div></div><div class="p-2"><div class="label text-sm">樓層分布</div><div class="chart" ld="chart" data-name="floor"></div></div><div class="p-2"><div class="label text-sm">交易距今(年)</div><div class="chart" ld="chart" data-name="timespan"></div></div><div class="p-2"><div class="label text-sm d-flex g-1 align-items-center" ld="pstat"><span>單價</span><div class="text-sm"><span class="text-sm text-muted">低</span><span ld="stat" data-name="q1"></span></div><div class="text-sm"><span class="text-sm text-muted">中</span><span ld="stat" data-name="q2"></span></div><div class="text-sm"><span class="text-sm text-muted">高</span><span ld="stat" data-name="q3"></span></div><div class="text-sm"><span class="text-sm text-muted">均</span><span ld="stat" data-name="avg"></span></div><div class="text-sm"><span class="text-sm text-muted">差</span><span ld="stat" data-name="stddev"></span></div></div><div class="chart" ld="chart" data-name="unitp"></div></div></div><div class="ldcv scroll autogap" ld="popup"><div class="w-640 rwd base"><div class="inner ldcv-popup"><div class="d-flex g-3"><div class="label">成交日</div><div class="value" ld="deal-date"></div></div><div class="d-flex g-3"><div class="label">地址</div><div class="value" ld="addr"></div></div><div class="d-flex g-3"><div class="label">屋齡</div><div class="value" ld="age"></div></div><div class="d-flex g-3"><div class="label">總價</div><div class="value" ld="total-price"></div></div><div class="d-flex g-3"><div class="label">單價</div><div class="value" ld="unit-price"></div></div><div class="d-flex g-3"><div class="label">樓層</div><div class="value" ld="floor"></div></div><div class="d-flex g-3"><div class="label">主坪</div><div class="value" ld="main-area"></div></div><div class="d-flex g-3"><div class="label">附坪</div><div class="value" ld="sec-area"></div></div><div class="d-flex g-3"><div class="label">陽台</div><div class="value" ld="balcony"></div></div></div></div></div><script type="text/javascript" src="/assets/lib/proxise/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/@loadingio/debounce.js/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/@loadingio/ldquery/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/@plotdb/semver/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/@plotdb/rescope/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/@plotdb/csscope/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/@plotdb/block/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/ldview/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/ldcover/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/ldcolor/main/index.min.js" defer></script><script type="module">(function(n){return n.apply({})})(function(){var M=this;return ld$.fetch("/assets/data/secret.json",{method:"GET"},{type:"json"}).then(function(e){var w,x,k;w=M;M.charts={};M.ldcv={};x=new block.manager({registry:function(n){var e,t,r,a,o,i;e=n.url,t=n.name,r=n.path,a=n.version,o=n.type;if(i=e){return i}if(t==="@plotdb/chart"&&(r==="bar"||r==="scatter")){return"/assets/chart/"+r+"/0.0.1/index.html"}if(t==="base"){return"/assets/chart/base/0.0.1/index.html"}if(!r){r=o==="js"?"index.min.js":o==="css"?"index.min.css":void 8}return"/assets/lib/"+t+"/main/"+r}});k=proxise(function(){var n;n=document.createElement("script");n.setAttribute("src","https://maps.googleapis.com/maps/api/js?key="+e.key+"&callback=init&v=weekly");return document.body.appendChild(n)});if(M.inited){return Promise.resolve()}window.init=function(){M.map=new google.maps.Map(document.getElementById("map"),{center:{lat:25.11509,lng:121.51525},zoom:15,clickableIcons:false,styles:[{featureType:"poi",stylers:[{saturation:-100}]}]});M.inited=true;return k.resolve()};return ld$.fetch("/assets/data/latlng.json",{method:"GET"},{type:"json"}).then(function(y){return ld$.fetch("/assets/data/all.json",{method:"GET"},{type:"json"}).then(function(p){var e,l,r,a,o,i,g,b,s,u,n,f,t,c,d,h,m,v;console.log(p);M.showEntry=function(n){this.entry=n.data;this.ldcv.popup.toggle();return v.render("popup")};console.log("input count: ",p.length);p=p.map(function(n){var e;n["門牌"]=n["門牌"].replace(/臺北市/,"");e=y[n["門牌"]];if(e){n.latlng={lat:e[1],lng:e[0]}}n["整單價"]=Math.round(n["單價"]);return n}).filter(function(n){return n.latlng}).filter(function(n){return n["整單價"]>10});console.log("filtered count: ",p.length);p.map(function(n){if(/北投/.exec(n["門牌"])){return console.log(n.latlng)}});e=function(n){var e,t,r,a;e=n.split("/").map(function(n){return+n}),t=e[0],r=e[1];t=t+1911;r=r-1;a=((Date.now()-new Date(t,r,2).getTime())/(1e3*86400*365)).toFixed(2);a=Math.round(a);return a};p.map(function(n){return n["年距"]=e(n["交易日"])});l={};p.map(function(n){var e;if(isNaN(n["年距"])){e=n["年距"]}else{e=+n["年距"];if(e>10){e="10+"}}return l[e]=(l[e]||0)+1});r=function(n,e){var t,r,a,o;t=n.slice().sort(function(n,e){return n-e});r=(t.length-1)*e;a=Math.floor(r);o=r-a;if(t[a+1]!=null){return t[a]+o*(t[a+1]-t[a])}else{return t[a]}};a=function(n){var t;t=n.reduce(function(n,e){return n+e},0)/n.length;return Math.sqrt(n.reduce(function(n,e){return n+Math.pow(e-t,2)},0)/n.length)};o=function(n){return n.reduce(function(n,e){return n+e},0)/n.length};i={};g={};b=function(n){var t;g={};t=[];n.map(function(n){var e;e=Math.round(n["單價"]);t.push(e);n["整單價"]=e;e=Math.floor(e/5)*5;if(e>110){e="110+"}return g[e]=(g[e]||0)+1});i.q1=Math.round(r(t,.25));i.q2=Math.round(r(t,.5));i.q3=Math.round(r(t,.75));i.stddev=Math.round(a(t));i.avg=Math.round(o(t));return v.render("pstat")};s={};p.map(function(n){var e;e=n["屋齡"];e=isNaN(e)?e:Math.ceil(e/5)*5;if(e>60){e="60+"}return s[e]=(s[e]||0)+1});u={};p.map(function(n){var e;e=n["樓層"][0];if(e<=0||isNaN(e)){e=0}if(e>10){e="10+"}n["樓層"]=[e];return u[e]=(u[e]||0)+1});n=p.map(function(n){return+n["單價"]}).filter(function(n){return n<600&&n>10});f={min:20,max:100};f.delta=(t=f.max-f.min)>1?t:1;p.map(function(n){var e,t;n.color=(e=(t=Math.round(100*(+n["單價"]-f.min)/f.delta))<100?t:100)>0?e:0;return n.color=(e=(t=Math.round(100*(+n["單價"]-f.min)/f.delta))<100?t:100)>0?e:0});n.sort(function(n,e){return e-n});c=function(n){var e,t,r;e=20+n*80/100;t=ldcolor.hex({r:n*255/100,g:0,b:0});r='<?xml version="1.0"?>\n<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 100 100">\n<rect x="0" y="0" width="100" height="100" rx="30" ry="30"\nfill="red" stroke="#000" stroke-width="10"/>\n<text font-family="sans-serif" font-size="75" fill="white"\nx="50" y="60" text-anchor="middle" dominant-baseline="middle">'+Math.round(e)+"</text>\n</svg>";return r="data:image/svg+xml;base64,"+btoa(r)};d=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100].map(function(n){return c(n)});h={floor:[],age:[],timespan:[],bound:{},render:debounce(function(){var n,e,t,r,a,o,i,l,s,u,f,c,d,h=this;n=[];console.log("樓層: ",this.floor," / 屋齡: ",this.age," / 交易年距今: ",this.timespan);for(e=0,t=p.length;e<t;++e){r=e;a=p[r];o=true;i=isNaN(a["屋齡"])?a["屋齡"]:Math.ceil(a["屋齡"]/5)*5;if(this.age.length&&!in$(i,this.age)){o=false}if(this.floor.length&&!(a["樓層"]||[]).filter(m).length){o=false}if(this.timespan.length&&!in$(a["年距"],this.timespan)){o=false}a.marker.setVisible(o);if(o){n.push(a)}}l=[];for(e=0,t=n.length;e<t;++e){r=e;a=n[r];if(a.latlng.lat>=((s=this.bound).lat||(s.lat={})).min&&a.latlng.lat<=((s=this.bound).lat||(s.lat={})).max&&a.latlng.lng>=((s=this.bound).lng||(s.lng={})).min&&a.latlng.lng<=((s=this.bound).lng||(s.lng={})).max){l.push(a)}}b(l);f=[];for(c in s=g){d=s[c];f.push({size:d,name:c})}u=f;return w.charts["unitp"].setRaw({raw:u,binding:{size:{key:"size"},name:{key:"name"}}});function m(n){return in$(n,h.floor)}})};m={age:function(n){var e;e=n.node;return x.from({name:"@plotdb/chart",path:"bar"},{root:e}).then(function(n){var e,t,r,a,o,i;e=n["interface"];e.config({legend:{enabled:false},yaxis:{enabled:false},xaxis:{tick:{inner:2,color:"rgb(255,92,100)"},baseline:{show:false},label:{format:"d"},caption:{show:false}}});r=[];for(a in o=s){i=o[a];r.push({size:i,name:a})}t=r;e.on("filter",function(n){h.age=((n.name||{}).value||[]).map(function(n){return+n});return h.render()});return e.setRaw({raw:t,binding:{size:{key:"size"},name:{key:"name"}}})})},floor:function(n){var e;e=n.node;return x.from({name:"@plotdb/chart",path:"bar"},{root:e}).then(function(n){var e,t,r,a,o,i;e=n["interface"];e.config({legend:{enabled:false},yaxis:{enabled:false},xaxis:{tick:{inner:2,color:"rgb(255,92,100)"},baseline:{show:false},label:{format:"d"},caption:{show:false}}});r=[];for(a in o=u){i=o[a];r.push({size:i,name:a})}t=r;e.on("filter",function(n){h.floor=((n.name||{}).value||[]).map(function(n){return+n});return h.render()});return e.setRaw({raw:t,binding:{size:{key:"size"},name:{key:"name"}}})})},timespan:function(n){var e;e=n.node;return x.from({name:"@plotdb/chart",path:"bar"},{root:e}).then(function(n){var e,t,r,a,o,i;e=n["interface"];e.config({legend:{enabled:false},yaxis:{enabled:false},xaxis:{tick:{inner:2,color:"rgb(255,92,100)"},baseline:{show:false},label:{format:"d"},caption:{show:false}}});r=[];for(a in o=l){i=o[a];r.push({size:i,name:a})}t=r;e.on("filter",function(n){h.timespan=((n.name||{}).value||[]).map(function(n){if(isNaN(n)){return n}else{return+n}});return h.render()});return e.setRaw({raw:t,binding:{size:{key:"size"},name:{key:"name"}}})})},unitp:function(n){var e;e=n.node;return x.from({name:"@plotdb/chart",path:"bar"},{root:e}).then(function(n){var e,t,r,a,o,i;M.charts["unitp"]=e=n["interface"];e.config({legend:{enabled:false},yaxis:{enabled:false},xaxis:{tick:{inner:2,color:"rgb(255,92,100)"},baseline:{show:false},label:{format:"d"},caption:{show:false}}});r=[];for(a in o=g){i=o[a];r.push({size:i,name:a})}t=r;return e.setRaw({raw:t,binding:{size:{key:"size"},name:{key:"name"}}})})},unitpx:function(n){var e;e=n.node;return x.from({name:"@plotdb/chart",path:"scatter"},{root:e}).then(function(n){var e,t,r,a,o,i;M.charts["unitp"]=e=n["interface"];e.config({legend:{enabled:false},yaxis:{enabled:false},xaxis:{tick:{inner:2,color:"rgb(255,92,100)"},baseline:{show:false},label:{format:"d"},caption:{show:false}}});r=[];for(a in o=g){i=o[a];r.push({s:i,x:a,y:1})}t=r;return e.setRaw({raw:t,binding:{x:{key:"x"},y:{key:"y"},size:{key:"s"}}})})}};v=new ldview({root:document.body,init:{chart:function(n){var e;e=n.node;return m[e.getAttribute("data-name")]({node:e})}},handler:{pstat:{text:{stat:function(n){var e;e=n.node;return i[e.dataset.name]||"0"}}},popup:{text:{"deal-date":function(n){var e;e=n.node;return(M.entry||(M.entry={}))["交易日"]},addr:function(n){var e;e=n.node;return(M.entry||(M.entry={}))["門牌"]},age:function(n){var e;e=n.node;return(M.entry||(M.entry={}))["屋齡"]},"total-price":function(n){var e;e=n.node;return(M.entry||(M.entry={}))["總價"]},"unit-price":function(n){var e;e=n.node;return(M.entry||(M.entry={}))["單價"]},floor:function(n){var e;e=n.node;return(M.entry||(M.entry={}))["樓層"]},"main-area":function(n){var e;e=n.node;return(M.entry||(M.entry={}))["主建"]},"sec-area":function(n){var e;e=n.node;return(M.entry||(M.entry={}))["附建"]},balcony:function(n){var e;e=n.node;return(M.entry||(M.entry={}))["陽台"]}}}}});return v.init().then(function(){return k()}).then(function(){var n,e,t,r,a;M.ldcv.popup=new ldcover({root:v.get("popup")});for(n=0,e=p.length;n<e;++n){t=n;r=p[t];a=new google.maps.Marker({position:r.latlng,icon:d[r.color]});r.marker=a;a.data=r;a.setMap(M.map);o(a)}return google.maps.event.addListener(M.map,"bounds_changed",debounce(function(){var n,e,t,r;n=M.map.getBounds();h.bound={};e=n.getNorthEast();t=n.getSouthWest();r=h.bound;r.lat={min:t.lat(),max:e.lat()};r.lng={min:t.lng(),max:e.lng()};return h.render()}));function o(n){return n.addListener("click",function(){return M.showEntry(n)})}})})})})});function in$(n,e){var t=-1,r=e.length>>>0;while(++t<r)if(n===e[t])return true;return false}</script></body></html>